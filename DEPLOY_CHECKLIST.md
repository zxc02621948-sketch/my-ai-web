# ✅ v0.8.0 部署檢查清單

## 📦 **準備階段**

### **已完成的修改**
- [x] 檢舉系統與站內信整合（5 個核心檔案）
- [x] 更新日誌更新為 v0.8.0
- [x] 首頁版本號更新為 v0.8.0
- [x] 測試腳本清理完成
- [x] 文檔生成完成

### **已修改的檔案清單**
```
核心功能 (6 個檔案):
✅ app/api/delete-image/route.js
✅ app/api/reports/[id]/route.js
✅ services/moderationService.js
✅ utils/notifTemplates.js
✅ app/messages/page.jsx
✅ models/Message.js

版本更新 (2 個檔案):
✅ app/changelog/page.jsx
✅ app/page.js

文檔 (3 個檔案):
✅ REPORT_MODERATION_MESSAGING.md
✅ MODERATION_FIXES_SUMMARY.md
✅ DEPLOYMENT_SUMMARY.md
```

---

## 🚀 **部署步驟**

### **步驟 1: Git 提交**
```bash
git add .
git commit -m "feat: v0.8.0 大版本更新 - 檢舉系統與站內信整合

✨ 新功能:
- 完整實現檢舉系統與站內信整合
- 管理員可更改圖片分類/分級並自動通知
- 檢舉狀態更新自動通知檢舉人
- 統一通知系統，全部使用站內信
- 新增 5 個站內信模板
- 站內信封存功能優化

🐛 修復:
- 修復站內信內容殘留問題
- 修復更改分類/分級功能斷裂
- 修復檢舉狀態更新缺少通知

📝 其他:
- 更新日誌更新為 v0.8.0
- 首頁版本號更新
- 清理測試腳本
- 完善文檔"
```

### **步驟 2: 推送到遠端**
```bash
git push origin master
```

### **步驟 3: Vercel 自動部署**
- Vercel 會自動檢測到變更
- 等待部署完成（通常 2-3 分鐘）
- 檢查部署日誌確認無錯誤

---

## 🧪 **部署後測試**

### **測試帳號（生產環境）**
```
管理員:
Email: test-admin@modtest.local
密碼: test123

圖片作者:
Email: test-user1@modtest.local
密碼: test123

檢舉人:
Email: test-user2@modtest.local
密碼: test123
```

### **功能測試清單**

#### **1. 更改分類功能** 🔧
- [ ] 登入管理員帳號
- [ ] 進入後台檢舉管理 (`/admin/reports`)
- [ ] 找到一個「分類錯誤」的檢舉
- [ ] 選擇「更改分類」操作
- [ ] 確認圖片分類已更新
- [ ] 登入圖片作者帳號，確認收到站內信
- [ ] 登入檢舉人帳號，確認收到處理結果通知

#### **2. 更改分級功能** 🔧
- [ ] 登入管理員帳號
- [ ] 找到一個「分級錯誤」的檢舉
- [ ] 選擇「更改分級」操作
- [ ] 確認圖片分級已更新
- [ ] 確認作者收到通知
- [ ] 確認檢舉人收到通知

#### **3. 刪除圖片功能** 🗑️
- [ ] 登入管理員帳號
- [ ] 找到一個「違規內容」的檢舉
- [ ] 選擇「刪除」操作
- [ ] 確認圖片已刪除
- [ ] 確認作者收到刪除通知
- [ ] 確認檢舉人收到處理結果通知

#### **4. 檢舉駁回功能** ❌
- [ ] 登入管理員帳號
- [ ] 找到一個檢舉
- [ ] 將狀態更新為「駁回」
- [ ] 添加備註說明
- [ ] 確認檢舉人收到駁回通知
- [ ] 確認作者未受影響（沒有收到通知）

#### **5. 站內信系統** 📬
- [ ] 登入測試用戶
- [ ] 進入站內信頁面
- [ ] 確認可以看到系統通知
- [ ] 測試封存功能
- [ ] 取消顯示封存，確認內容正確清理
- [ ] 測試恢復功能

#### **6. 版本更新顯示** 📝
- [ ] 訪問首頁
- [ ] 確認頁尾顯示「版本 v0.8.0（2025-10-15）🎉」
- [ ] 點擊「查看更新內容」
- [ ] 確認更新日誌正確顯示 v0.8.0 內容
- [ ] 確認所有分類和功能描述正確

---

## 📊 **數據檢查**

### **檢舉狀態**
- [ ] 確認檢舉狀態正確更新（`open` → `action_taken` / `rejected` / `closed`）
- [ ] 確認 `resolution` 欄位正確記錄（`reclassified` / `rerated` / `deleted`）
- [ ] 確認 `resolvedAt` 時間戳正確

### **站內信**
- [ ] 確認站內信正確發送
- [ ] 確認 `conversationId` 格式正確（`pair:userId:system`）
- [ ] 確認模板渲染正確
- [ ] 確認 `ref` 欄位包含操作詳情

### **圖片更新**
- [ ] 確認更改分類後圖片 `category` 欄位正確
- [ ] 確認更改分級後圖片 `rating` 欄位正確
- [ ] 確認刪除操作後圖片已從資料庫移除

---

## ⚠️ **注意事項**

### **無需執行**
- ❌ 無需資料庫遷移
- ❌ 無需手動清理舊數據
- ❌ 無需重啟服務
- ❌ 無需更新環境變數

### **向後兼容**
- ✅ 所有修改都向後兼容
- ✅ 舊檢舉數據不受影響
- ✅ 舊站內信數據不受影響
- ✅ 新欄位都是可選的

### **已知限制**
- 本地開發環境測試帳號可能無法登入（資料庫環境不同）
- 生產環境測試帳號正常可用

---

## 🎯 **預期結果**

### **管理員體驗**
- ✅ 可以正常使用更改分類/分級功能
- ✅ 處理檢舉後自動通知相關用戶
- ✅ 更完整的操作記錄

### **用戶體驗**
- ✅ 收到清晰的處理結果通知
- ✅ 了解圖片被調整的原因
- ✅ 統一的通知管理體驗

### **系統改進**
- ✅ 通知系統完全統一
- ✅ 檢舉處理流程完整
- ✅ 站內信功能穩定

---

## 🐛 **問題排查**

### **如果檢舉處理沒有發送站內信**
1. 檢查瀏覽器 Network 標籤，確認 API 回應
2. 檢查後端日誌，查看是否有錯誤
3. 確認 `notify` 參數為 `true`
4. 確認模板 key 正確

### **如果站內信模板渲染錯誤**
1. 檢查 `utils/notifTemplates.js` 是否正確部署
2. 檢查模板 key 是否拼寫正確
3. 檢查傳遞的 context 是否包含所有必要欄位

### **如果更改分類/分級失敗**
1. 確認管理員權限
2. 檢查 `adminAction` 參數是否正確傳遞
3. 檢查 `newCategory` 或 `newRating` 是否提供
4. 查看後端日誌確認錯誤原因

---

## 📞 **聯絡方式**

如果部署過程中遇到問題：
1. 檢查 Vercel 部署日誌
2. 檢查瀏覽器 Console 和 Network
3. 檢查後端 API 錯誤日誌
4. 參考文檔：`MODERATION_FIXES_SUMMARY.md`

---

## ✅ **部署完成確認**

- [ ] Git 提交成功
- [ ] Git 推送成功
- [ ] Vercel 部署成功
- [ ] 版本號正確顯示
- [ ] 更新日誌正確顯示
- [ ] 所有測試通過
- [ ] 無錯誤日誌

---

🎉 **準備好了！開始部署 v0.8.0 吧！**

