# 分類系統遷移計劃

## 🎯 目標
從單選分類系統平滑遷移到多選分類系統，確保現有數據不會錯亂。

## 📊 現狀分析
- **現有分類使用情況**：
  - 人物: 24張 (49%)
  - 動漫: 16張 (33%)
  - 風景: 4張 (8%)
  - 動物: 3張 (6%)
  - 物品: 1張 (2%)
  - 其他: 1張 (2%)

## 🔄 遷移策略

### 階段1：數據庫結構升級（向後相容）
```javascript
// 新增欄位，保留舊欄位
{
  category: String,           // 舊欄位，保持不變
  categories: [String],       // 新欄位，多選分類
  migrated: Boolean          // 遷移標記
}
```

### 階段2：分類映射規則
```javascript
const CATEGORY_MAPPING = {
  // 舊分類 → 新分類組合
  "人物": ["人物/角色"],
  "動漫": ["人物/角色", "動漫風格"],
  "風景": ["風景/場景"],
  "動物": ["動物/寵物"],
  "物品": ["物品/靜物"],
  "擬真": ["寫實風格"],
  "食物": ["物品/靜物"],
  "其他": ["其他"]
};
```

### 階段3：新分類系統
```javascript
const NEW_CATEGORIES = [
  "人物/角色",     // 人物 + 動漫角色
  "風景/場景",     // 風景 + 背景場景
  "動漫風格",     // 二次元風格
  "寫實風格",     // 擬真、照片風格
  "動物/寵物",    // 動物相關
  "物品/靜物",    // 物品、道具、食物
  "創意作品",     // 藝術、抽象創意
  "其他"         // 兜底分類
];
```

## 🛠️ 實施步驟

### Step 1: 數據庫遷移腳本
- 為所有現有圖片添加 `categories` 欄位
- 根據映射規則自動轉換
- 設置 `migrated: true` 標記

### Step 2: API 向後相容
- 讀取時：優先使用 `categories`，fallback 到 `category`
- 寫入時：同時更新兩個欄位
- 篩選時：支援兩種格式

### Step 3: UI 漸進升級
- 保留舊分類選項作為快捷選擇
- 新增多選功能
- 提供一鍵遷移按鈕

### Step 4: 清理階段
- 確認所有圖片都已遷移
- 移除舊欄位和相關代碼

## ✅ 優勢
1. **零停機時間**：向後相容，不影響現有功能
2. **數據安全**：保留原始分類，可隨時回滾
3. **用戶友好**：漸進式升級，用戶可選擇使用時機
4. **性能無損**：利用現有索引，不影響查詢效率

## 🔍 風險控制
- 保留原始 `category` 欄位作為備份
- 分批遷移，可隨時暫停
- 提供回滾機制
- 充分測試後再部署