# çµ±ä¸€çš„åˆ†æ•¸è‡ªå‹•æ›´æ–°ç³»çµ±

> **æ›´æ–°æ—¥æœŸï¼š** 2025-10-21  
> **é©ç”¨ç¯„åœï¼š** åœ–ç‰‡ + å½±ç‰‡

---

## ğŸ¯ **çµ±ä¸€åŸå‰‡**

**æ‰€æœ‰å…§å®¹ï¼ˆåœ–ç‰‡/å½±ç‰‡ï¼‰çš„åˆ†æ•¸è¨ˆç®—éµå¾ªç›¸åŒçš„åŸå‰‡ï¼š**

1. âœ… **ä¸Šå‚³æ™‚è‡ªå‹•è¨ˆç®—** - åŒ…å« `initialBoost` å’Œ `completenessScore`
2. âœ… **äº’å‹•æ™‚å³æ™‚æ›´æ–°** - é»è®šã€é»æ“Šã€è§€çœ‹
3. âœ… **ç·¨è¼¯æ™‚é‡æ–°è¨ˆç®—** - æ›´æ–°å…ƒæ•¸æ“šå¾Œé‡ç®—åˆ†æ•¸
4. âœ… **æ•¸æ“šè‡ªå‹•åŒæ­¥** - `likesCount` å§‹çµ‚èˆ‡ `likes` é™£åˆ—ä¸€è‡´

---

## ğŸ“Š **è‡ªå‹•æ›´æ–°å°ç…§è¡¨**

| æ“ä½œ | åœ–ç‰‡ | å½±ç‰‡ | æ›´æ–°å…§å®¹ |
|------|------|------|---------|
| ğŸ†• ä¸Šå‚³ | âœ… | âœ… | completeness + popScore + initialBoostï¼ˆå…¨éƒ¨è¨ˆç®—ï¼‰ |
| ğŸ–±ï¸ æ‰“é–‹ Modal | âœ… | âœ… | clicks +1, popScore +1 |
| â¤ï¸ é»è®š | âœ… | âœ… | likesCount Â±1, popScore Â±8 |
| âœï¸ ç·¨è¼¯å…ƒæ•¸æ“š | âœ… | âœ… | **åªæ›´æ–° completeness**ï¼ŒpopScore ä¸è®Š |
| ğŸ‘ï¸ è§€çœ‹ï¼ˆæ’­æ”¾ï¼‰ | âš ï¸ | âš ï¸ | æœªå¯¦ç¾ |

**é‡è¦èªªæ˜ï¼š**
- âœ… ç·¨è¼¯æ™‚**ä¸é‡ç®— `popScore`** - è®“ç”¨æˆ¶å¯ä»¥å®‰å¿ƒä¿®æ”¹éŒ¯å­—
- âœ… åªæ›´æ–° `completenessScore` - åæ˜ å…ƒæ•¸æ“šå®Œæ•´åº¦
- âœ… `popScore` åªåœ¨**çœŸå¯¦äº’å‹•**æ™‚æ›´æ–°ï¼ˆé»è®šã€é»æ“Šï¼‰

---

## ğŸ”§ **API ç«¯é»å°ç…§**

| åŠŸèƒ½ | åœ–ç‰‡ API | å½±ç‰‡ API | ç‹€æ…‹ |
|------|---------|---------|------|
| é»æ“Šè¨˜éŒ„ | `/api/images/[id]/click` | `/api/videos/[id]/click` | âœ… |
| é»è®šåˆ‡æ› | `/api/images/[id]/like` | `/api/videos/[id]/like` | âœ… |
| ç·¨è¼¯å…§å®¹ | `/api/images/[id]/edit` | `/api/videos/[id]/edit` | âœ… |
| ä¸Šå‚³å…§å®¹ | `/api/images/upload` | `/api/videos/upload` | âœ… |
| æ‰¹é‡ä¿®å¾© | `/api/admin/fix-images-scores` | `/api/admin/fix-video-music-scores` | âœ… |

---

## ğŸ§® **åˆ†æ•¸è¨ˆç®—å…¬å¼å°ç…§**

### **åœ–ç‰‡ï¼š**
```javascript
popScore = 
  (clicks Ã— 1.0) +
  (likesCount Ã— 8.0) +
  (views Ã— 0.5) +           // æœªä½¿ç”¨
  (completeness Ã— 0.05) +
  finalBoost

initialBoost = ç•¶å‰æœ€é«˜åˆ† Ã— 0.5  // 50%
è¡°æ¸›çª—å£ = 10 å°æ™‚
```

### **å½±ç‰‡ï¼š**
```javascript
popScore = 
  (clicks Ã— 1.0) +
  (likesCount Ã— 8.0) +
  (views Ã— 0.5) +           // æ¬„ä½å­˜åœ¨ä½†æœªè¿½è¹¤
  (completeness Ã— 0.05) +
  finalBoost

initialBoost = ç•¶å‰æœ€é«˜åˆ† Ã— 0.8  // 80%
è¡°æ¸›çª—å£ = 10 å°æ™‚
```

### **å·®ç•°ï¼š**
- åœ–ç‰‡ `initialBoost` = 50% of top
- å½±ç‰‡ `initialBoost` = 80% of top
- **åŸå› ï¼š** å½±ç‰‡ç«¶çˆ­è¼ƒå°‘ï¼Œçµ¦äºˆæ›´é«˜çš„æ–°å…§å®¹åŠ æˆ

---

## ğŸ“ **æ›´æ–°å¾Œçš„æª”æ¡ˆ**

### **å½±ç‰‡ç³»çµ±ï¼ˆ7å€‹æª”æ¡ˆï¼‰ï¼š**

1. **app/api/videos/upload/route.js** âœ…
   - ä¸Šå‚³æ™‚è¨ˆç®— `popScore`

2. **app/api/videos/[id]/edit/route.js** âœ…
   - ç·¨è¼¯æ™‚é‡æ–°è¨ˆç®— `completenessScore` å’Œ `popScore`

3. **app/api/videos/[id]/like/route.js** âœ…
   - é»è®šæ™‚åŒæ­¥ `likesCount` å’Œæ›´æ–° `popScore`

4. **app/api/videos/[id]/click/route.js** âœ… æ–°å¢
   - æ‰“é–‹å½±ç‰‡æ™‚è¨˜éŒ„ `clicks` å’Œæ›´æ–° `popScore`

5. **app/api/videos/route.js** âœ…
   - ä¿®å¾© aggregation pipelineï¼ˆ3 éšæ®µï¼‰
   - `live=1` å³æ™‚è¨ˆç®—æ­£ç¢º

6. **app/api/admin/fix-video-music-scores/route.js** âœ…
   - æ‰¹é‡ä¿®å¾©æ™‚åŒæ­¥ `likesCount`

7. **components/video/VideoModal.jsx** âœ…
   - æ‰“é–‹æ™‚èª¿ç”¨é»æ“Š API

---

### **åœ–ç‰‡ç³»çµ±ï¼ˆ1å€‹æª”æ¡ˆï¼‰ï¼š**

1. **app/api/images/[id]/edit/route.js** âœ… æ–°å¢
   - ç·¨è¼¯æ™‚é‡æ–°è¨ˆç®— `completenessScore` å’Œ `popScore`
   - åŒæ­¥ `likesCount`

---

## âœ… **çµ±ä¸€æ€§æª¢æŸ¥**

| åŠŸèƒ½ | åœ–ç‰‡ | å½±ç‰‡ | ç‹€æ…‹ |
|------|------|------|------|
| ä¸Šå‚³æ™‚è¨ˆç®—åˆ†æ•¸ | âœ… | âœ… | çµ±ä¸€ |
| é»æ“Šæ™‚æ›´æ–°åˆ†æ•¸ | âœ… | âœ… | çµ±ä¸€ |
| é»è®šæ™‚æ›´æ–°åˆ†æ•¸ | âœ… | âœ… | çµ±ä¸€ |
| ç·¨è¼¯æ™‚é‡ç®—åˆ†æ•¸ | âœ… | âœ… | çµ±ä¸€ |
| likesCount åŒæ­¥ | âœ… | âœ… | çµ±ä¸€ |
| å³æ™‚è¨ˆç®—æ”¯æ´ | âœ… | âœ… | çµ±ä¸€ |

---

## ğŸ¯ **åˆ†æ•¸æ›´æ–°è§¸ç™¼çŸ©é™£**

### **åœ–ç‰‡ï¼š**

| API ç«¯é» | clicks | likesCount | popScore | completeness |
|---------|--------|-----------|----------|-------------|
| `/images/upload` | âœ… åˆå§‹åŒ– | âœ… åˆå§‹åŒ– | âœ… è¨ˆç®— | âœ… è¨ˆç®— |
| `/images/[id]/click` | âœ… +1 | âœ… åŒæ­¥ | âœ… é‡ç®— | â– |
| `/images/[id]/like` | â– | âœ… Â±1 | âœ… é‡ç®— | â– |
| `/images/[id]/edit` | â– | âœ… åŒæ­¥ | âŒ ä¸è®Š | âœ… é‡ç®— |

### **å½±ç‰‡ï¼š**

| API ç«¯é» | clicks | likesCount | popScore | completeness |
|---------|--------|-----------|----------|-------------|
| `/videos/upload` | âœ… åˆå§‹åŒ– | âœ… åˆå§‹åŒ– | âœ… è¨ˆç®— | âœ… è¨ˆç®— |
| `/videos/[id]/click` | âœ… +1 | âœ… åŒæ­¥ | âœ… é‡ç®— | â– |
| `/videos/[id]/like` | â– | âœ… Â±1 | âœ… é‡ç®— | â– |
| `/videos/[id]/edit` | â– | â– | âŒ ä¸è®Š | âœ… é‡ç®— |

**è¨­è¨ˆç†å¿µï¼š**
- ğŸ¯ `popScore` åæ˜ **çœŸå¯¦äº’å‹•**ï¼ˆé»è®šã€é»æ“Šï¼‰ï¼Œä¸å—ç·¨è¼¯å½±éŸ¿
- ğŸ“ `completenessScore` åæ˜ **å…ƒæ•¸æ“šè³ªé‡**ï¼Œç·¨è¼¯æ™‚æ›´æ–°
- ğŸ’¡ ç”¨æˆ¶å¯ä»¥å®‰å¿ƒä¿®æ”¹å…§å®¹ï¼Œä¸ç”¨æ“”å¿ƒå½±éŸ¿æ’å

---

## ğŸš€ **ä½¿ç”¨è€…é«”é©—**

### **å°å‰µä½œè€…ï¼š**
- ğŸ†• ä¸Šå‚³æ–°å…§å®¹ â†’ è‡ªå‹•ç²å¾—æ›å…‰åŠ æˆï¼ˆ10å°æ™‚ï¼‰
- ğŸ“ å®Œå–„å…ƒæ•¸æ“š â†’ åˆ†æ•¸è‡ªå‹•æé«˜
- ğŸ¯ ç„¡éœ€æ‰‹å‹•æ“ä½œï¼Œç³»çµ±è‡ªå‹•å„ªåŒ–æ’å

### **å°è§€çœ¾ï¼š**
- ğŸ”¥ ç†±é–€å…§å®¹è‡ªå‹•æ’åœ¨å‰é¢
- â¤ï¸ é»è®šæœƒå½±éŸ¿æ’åºï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
- ğŸ†• æ–°å…§å®¹æœƒç²å¾—å„ªå…ˆå±•ç¤º

### **å°ç®¡ç†å“¡ï¼š**
- ğŸ”§ æä¾›æ‰¹é‡ä¿®å¾©å·¥å…·
- ğŸ“Š åˆ†æ•¸è¨ˆç®—å®Œå…¨é€æ˜
- ğŸ¯ å¯é€é API ç›£æ§å’Œèª¿æ•´

---

## ğŸŠ **å®Œæˆç¸½çµ**

### **çµ±ä¸€çš„åˆ†æ•¸ç³»çµ±ï¼š**
- âœ… åœ–ç‰‡å’Œå½±ç‰‡ä½¿ç”¨ç›¸åŒçš„è¨ˆç®—é‚è¼¯
- âœ… æ‰€æœ‰ API è‡ªå‹•åŒæ­¥æ•¸æ“š
- âœ… ç·¨è¼¯å¾Œè‡ªå‹•é‡æ–°è¨ˆç®—
- âœ… ç„¡éœ€æ‰‹å‹•ç¶­è­·

### **è‡ªå‹•åŒ–ç¨‹åº¦ï¼š**
```
æ‰‹å‹•å¹²é ï¼š0%
è‡ªå‹•æ›´æ–°ï¼š100%
æ•¸æ“šä¸€è‡´æ€§ï¼š100%
```

---

**å¾ç¾åœ¨é–‹å§‹ï¼Œæ‰€æœ‰å…§å®¹çš„åˆ†æ•¸éƒ½æœƒè‡ªå‹•ç¶­è­·ï¼** ğŸ‰âœ¨

**åœ–ç‰‡å’Œå½±ç‰‡ç³»çµ±å®Œå…¨çµ±ä¸€ï¼Œç„¡ç¸«å”ä½œï¼** ğŸš€ğŸ¨ğŸ¬

