# 留言內容智能過濾

> **更新日期：** 2025-10-22  
> **修改：** 移除文字黑名單，改用檢舉機制

---

## 🎯 **過濾機制**

### **1. 純數字/符號過濾** ✅

**規則：**
```javascript
// 禁止只包含：數字、空格、標點符號
正則：/^[\d\s\.\,\!\?\~\-\_\+\=]+$/
```

**被禁止的留言：**
```
❌ 「11」
❌ 「12」
❌ 「666」
❌ 「888」
❌ 「1.2.3」
❌ 「!!!」
❌ 「???」
❌ 「+++」
❌ 「---」
```

**允許的留言：**
```
✅ 「1920x1080」（包含字母 x）
✅ 「SD 1.5」（包含字母 SD）
✅ 「CFG 7」（包含字母 CFG）
✅ 「用 28 步」（包含中文字）
✅ 「好看666」（包含中文字）
```

---

### **2. 文字黑名單** ❌ 已移除

**為什麼移除？**
- 太嚴格，可能誤傷正常使用（如「沙發」「頭香」可能有人真的常用）
- 無法應對變化的灌水手法
- 缺乏靈活性

**替代方案：** 改用**檢舉機制** → 詳見 `COMMENT_REPORT_FEATURE.md`

---

## 🛡️ **完整的過濾流程**

```
用戶輸入留言
    ↓
1. 長度檢查（2-500 字）
    ↓
2. 純數字/符號檢查
    ❌ 「11」「666」「!!!」→ 被拒絕
    ✅ 「好看666」「CFG 7」→ 通過
    ↓
3. 時間間隔檢查（3秒/10秒）
    ↓
4. 重複內容檢查
    ↓
5. 每日上限檢查
    ↓
✅ 所有檢查通過 → 發送成功
    ↓
如果有灌水/辱罵/廣告 → 其他用戶可「檢舉」→ 管理員審核
```

---

## 📊 **過濾效果示例**

### **場景 1：刷數字被阻止**

```
用戶嘗試：
1. 留言「11」→ ❌ 「留言需要包含文字內容，不能只有數字或符號」
2. 留言「12」→ ❌ 同上
3. 留言「好11」→ ✅ 通過（包含文字）
```

### **場景 2：技術討論不受影響**

```
用戶討論：
1. 「1920x1080」→ ✅ 通過（包含字母 x）
2. 「用28步」→ ✅ 通過（包含中文）
3. 「CFG 7」→ ✅ 通過（包含字母）
4. 「SD1.5模型」→ ✅ 通過（包含中文和字母）
```

### **場景 3：社群檢舉**

```
用戶發現灌水：
1. 看到「沙發」「頭香」等灌水留言
2. 點擊「🚩 檢舉」按鈕
3. 填寫檢舉原因
4. 管理員審核處理（刪除/警告/封禁）
```

---

## 🎯 **正則表達式詳解**

```javascript
/^[\d\s\.\,\!\?\~\-\_\+\=]+$/

解釋：
^          - 開頭
[          - 字符集開始
  \d       - 數字 0-9
  \s       - 空格
  \.       - 點 .
  \,       - 逗號 ,
  \!       - 驚嘆號 !
  \?       - 問號 ?
  \~       - 波浪號 ~
  \-       - 減號 -
  \_       - 底線 _
  \+       - 加號 +
  \=       - 等號 =
]          - 字符集結束
+          - 一個或多個
$          - 結尾

意思：只包含數字和這些符號的留言會被拒絕
```

**為什麼不包含字母和中文？**
- 一旦包含字母（a-z, A-Z）→ 通過
- 一旦包含中文（\u4e00-\u9fa5）→ 通過

---

## 📈 **效果驗證**

### **測試腳本：**

```javascript
// 在瀏覽器 Console 測試
const testCases = [
  { text: '11', expected: '被拒絕（純數字）' },
  { text: '666', expected: '被拒絕（純數字）' },
  { text: '1.2.3', expected: '被拒絕（純數字+符號）' },
  { text: '!!!', expected: '被拒絕（純符號）' },
  { text: '頂', expected: '被拒絕（黑名單）' },
  { text: '+1', expected: '被拒絕（黑名單）' },
  { text: '好看', expected: '✅ 通過' },
  { text: '好看666', expected: '✅ 通過（包含文字）' },
  { text: '1920x1080', expected: '✅ 通過（包含字母）' },
  { text: 'CFG 7', expected: '✅ 通過（包含字母）' },
  { text: '用28步', expected: '✅ 通過（包含中文）' },
  { text: '推薦', expected: '✅ 通過（不在黑名單）' }
];

// 實際測試（需要在圖片頁面）
testCases.forEach(({ text, expected }) => {
  console.log(`測試：「${text}」 → ${expected}`);
  // 手動在留言框輸入並發送
});
```

---

## 🎊 **完整的防刷體系**

### **現在的多層防護：**

```
第 1 層：內容檢查
  ├─ 長度：2-500 字
  ├─ 純數字/符號：✅ 新增（禁止「11」「666」）
  └─ 黑名單：✅ 新增（禁止「頂」「推」）

第 2 層：時間間隔
  ├─ 全局：3 秒
  └─ 同圖：10 秒

第 3 層：數量限制
  ├─ 每日：50 條（VIP 100）
  └─ 單圖：20 條

第 4 層：重複檢測
  └─ 最近 5 條不能相同

第 5 層：成本分析
  └─ 刷留言 >> 點讚（自然抑制）
```

---

## ✅ **現在的防禦力**

### **用戶嘗試刷數字：**

```
嘗試 1：「11」→ ❌ 「留言需要包含文字內容」
嘗試 2：「12」→ ❌ 同上
嘗試 3：「13」→ ❌ 同上
嘗試 4：「666」→ ❌ 同上
嘗試 5：「a11」→ ✅ 通過（包含字母 a）
嘗試 6：「a12」→ ✅ 通過
嘗試 7：「a11」→ ❌ 「請不要重複發送相同的留言」
嘗試 8：「a13」→ 需等待 3-10 秒
...

成本：
- 需要在每條前面加字母
- 需要等待時間
- 每日最多 50 條 = 100 分
- 遠不如點讚（13 秒 = 100 分）

結論：完全不划算！✅
```

---

## 🎯 **技術討論不受影響**

### **常見技術留言：**

```
✅ 「1920x1080」 - 包含 x（字母）
✅ 「SD 1.5」 - 包含 SD（字母）和空格
✅ 「CFG 7」 - 包含 CFG（字母）
✅ 「用28步」 - 包含「用」和「步」（中文）
✅ 「fps30」 - 包含 fps（字母）
✅ 「4090顯卡」 - 包含「顯卡」（中文）
```

---

## 🔧 **如何調整過濾規則**

### **添加更多禁止符號：**

編輯 `utils/commentLimits.js`：

```javascript
// 如果需要禁止更多符號，修改正則表達式
const isPureNumberOrSymbol = /^[\d\s\.\,\!\?\~\-\_\+\=]+$/.test(trimmed);
//                                                 ↑
//                          在這裡添加要禁止的符號
```

**注意：** 只禁止「純數字/符號」組合，包含文字的留言不受影響。

---

## 🎊 **總結**

**現在的過濾策略：**
- ✅ 禁止純數字（「11」「12」「666」）
- ✅ 禁止純符號（「!!!」「???」）
- ❌ 不使用文字黑名單（太嚴格）
- ✅ 改用檢舉機制（靈活、不誤傷）
- ✅ 不影響技術討論（「CFG 7」「1920x1080」）

**防刷效果：**
- ✅ 刷數字被完全阻止
- ✅ 時間間隔 + 重複檢查防連發
- ✅ 社群檢舉處理邊緣案例
- ✅ 成本極高，收益極低
- ✅ 留言區質量大幅提升

**完美的平衡：技術防刷 + 社群檢舉！** 🎉🛡️✨

---

**現在「11」「12」「666」等純數字會被拒絕，但「沙發」「頭香」等詞可以正常使用，如有濫用可透過檢舉機制處理！**

