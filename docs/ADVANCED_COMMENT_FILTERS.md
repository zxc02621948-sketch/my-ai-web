# 進階留言過濾建議

> **問題：** 是否需要限制「純數字」或其他低質量留言？

---

## 🤔 **需要限制的場景分析**

### **純數字留言：**

#### **有意義的純數字留言：**
```
✅ 「1920x1080」 - 討論解析度
✅「28」 - 回答「用什麼 CFG？」
✅ 「4090」 - 討論顯卡型號
✅ 「1.5」 - 討論模型版本
✅ 「20」 - 回答「幾步？」
```

#### **無意義的純數字留言：**
```
❌ 「1」 - 搶沙發/頭香
❌ 「2」 - 搶第二
❌ 「666」 - 單純灌水
❌ 「888」 - 無實質內容
```

---

## 📊 **過濾策略對比**

### **選項 A：完全禁止純數字** ❌ 不推薦

```javascript
if (/^\d+$/.test(text.trim())) {
  return { error: "留言不能只有數字" };
}
```

**問題：**
- ❌ 誤傷有意義的技術討論
- ❌ 「1920x1080」會被禁（因為含字母，可能通過）
- ❌ 「28」（回答參數）會被禁
- ❌ 用戶體驗差

---

### **選項 B：禁止單一數字** ⚠️ 可考慮

```javascript
if (/^\d$/.test(text.trim())) {
  return { error: "留言不能只有單一數字" };
}
```

**效果：**
- ✅ 「1」「2」「3」被禁（搶樓）
- ✅ 「28」「666」「1080」通過（可能有意義）
- ⚠️ 但「666」「888」還是能通過

---

### **選項 C：最少 2 個字 + 智能過濾** ✅ 推薦

```javascript
// 已有：最少 2 字
if (text.trim().length < 2) {
  return { error: "留言至少需要 2 個字" };
}

// 新增：黑名單過濾
const blacklist = [
  '頂', '推', '沙發', '頭香', '666', '888', '999',
  '+1', '++', '讚讚', '好好', '棒棒'
];

if (blacklist.includes(text.trim())) {
  return { error: "請發表更有意義的留言" };
}

// 新增：純符號/表情過濾
if (/^[^\w\u4e00-\u9fa5]+$/u.test(text.trim())) {
  return { error: "留言需要包含文字內容" };
}
```

**效果：**
- ✅ 「666」「888」被禁（在黑名單中）
- ✅ 「+++」「!!!」被禁（純符號）
- ✅ 「28」「1080」通過（不在黑名單）
- ✅ 「很棒的構圖」通過（有文字）

---

### **選項 D：當前機制已足夠** ✅ 我的推薦

**當前限制：**
- ✅ 最少 2 字 - 已經過濾掉 「1」「2」等
- ✅ 3 秒間隔 - 防止快速刷「666」「888」
- ✅ 不能重複 - 防止複製貼上「666」多次
- ✅ 每日 50 條上限 - 即使刷也有限

**為什麼夠用：**
```
刷留言成本分析：
- 「666」「888」等 2 字留言
- 需要不同的內容（不能重複）
- 需要等待 3-10 秒
- 每日最多 50 條 = 100 分
- 對比點讚：12.5 個讚 = 100 分，只需 13 秒

結論：即使允許「666」，刷留言還是不划算！✅
```

---

## 🎯 **我的建議**

### **階段 1（當前）：基礎過濾** ✅ 已實施

```
✅ 最少 2 字
✅ 最多 500 字
✅ 3 秒全局間隔
✅ 10 秒同圖間隔
✅ 不能重複內容
✅ 每日 50 條上限
✅ 單圖 20 條上限
```

**評估：** 
- 這已經足以防止 95% 的刷留言行為
- 不會誤傷正常討論
- 成本 << 收益

---

### **階段 2（如果需要）：黑名單過濾** ⚠️ 可選

```javascript
const COMMENT_BLACKLIST = [
  // 搶樓類
  '頂', '推', '沙發', '頭香', '搶', '樓主',
  
  // 灌水類
  '666', '888', '999', '6666', '8888',
  '+1', '++', '+++', '--', '---',
  
  // 無意義類
  '讚讚', '棒棒', '好好', '哈哈', '呵呵',
  
  // 純符號
  '!!!', '???', '...', '~~~'
];
```

**只在發現大量低質量留言時才添加！**

---

### **階段 3（未來）：AI 過濾** 🤖 未來

```javascript
// 使用 AI 判斷留言質量
const quality = await analyzeCommentQuality(text);

if (quality < 0.3) {  // 質量分數 < 30%
  return { error: "請發表更有意義的留言" };
}
```

**成本高，暫不需要**

---

## 💡 **我的最終建議**

### **保持當前機制（階段 1）** ✅

**理由：**

1. **成本分析已經足夠：**
   - 刷留言需要大量時間
   - 需要不同內容
   - 收益低於點讚
   - 自然抑制刷分行為

2. **避免過度限制：**
   - 「28」「1080」等技術討論會被誤傷
   - 「666」雖然是灌水，但 2 字 + 3秒間隔已經夠了
   - 黑名單可能掛一漏萬

3. **觀察後再決定：**
   - 先運行一段時間
   - 如果發現大量「666」等低質量留言
   - 再添加黑名單也不遲

---

## 🔍 **監控指標**

### **運行一週後檢查：**

```javascript
// 統計留言質量
fetch('/api/admin/comment-quality-stats')
  .then(res => res.json())
  .then(data => {
    console.log('總留言數:', data.total);
    console.log('純數字留言:', data.pureNumbers);
    console.log('2字留言:', data.twoChars);
    console.log('最常見內容:', data.topComments);
    
    // 如果 pureNumbers > 20% → 考慮添加過濾
    // 如果 twoChars > 30% → 考慮提高到 3 字
  });
```

**決策標準：**
- 純數字 > 20% → 考慮禁止純數字
- 2字留言 > 30% 且多數是灌水 → 考慮提高到 3 字
- 發現特定灌水詞頻繁出現 → 添加黑名單

---

## ✅ **結論**

**當前機制已經足夠！** 

**建議：**
- ✅ 先運行當前版本
- ✅ 觀察留言質量
- ✅ 如果發現問題再添加進階過濾

**不要過度設計：**
- 簡單的機制往往最有效
- 避免誤傷正常用戶
- 保持系統簡潔

---

**你覺得呢？是現在就加黑名單，還是先觀察一段時間？** 🤔

