# 留言限制詳細說明

> **釐清疑問：** 「單圖上限 20 條」是什麼意思？

---

## 🎯 **答案：每個人對每張圖最多留言 20 次**

---

## 📊 **圖解說明**

### **情境：熱門圖片 A**

```
┌─────────────────────────────────────────┐
│  圖片 A：「精美的 AI 生成圖」           │
│                                         │
│  總留言數：無上限！                     │
│  （取決於有多少人討論）                 │
└─────────────────────────────────────────┘

👤 用戶甲（普通用戶）：
   ├─ 留言 1：「很棒！」                   ✅
   ├─ 留言 2：「請問用什麼模型？」         ✅
   ├─ 留言 3：「構圖很好」                 ✅
   ├─ ...
   ├─ 留言 20：「感謝分享」                ✅
   └─ 留言 21：❌ 被拒絕（你在此圖片的留言已達上限）

👤 用戶乙（作者）：
   ├─ 留言 1：「謝謝！用的是 XX 模型」     ✅
   ├─ 留言 2：「這是工作流連結...」       ✅
   ├─ ...
   └─ 留言 15：「歡迎交流！」              ✅
   └─ 還可以留言 5 條（15/20）            ✅

👤 用戶丙、丁、戊...（其他用戶）：
   └─ 各自都可以留言最多 20 條            ✅

═══════════════════════════════════════════
圖片 A 總留言數：20 + 15 + (其他用戶) = 50+ 條 ✅
每個用戶都在 20 條限制內 ✅
```

---

## 🎯 **所有限制總覽**

### **針對「每個用戶」的限制：**

| 限制類型 | 範圍 | 限制 | 說明 |
|---------|------|------|------|
| 全局間隔 | 所有圖片 | 3 秒 | 連續留言需要等待 |
| 同圖間隔 | 單張圖片 | 10 秒 | 在同一張圖連續留言需要等待 |
| 每日上限 | 所有圖片 | 50 條（VIP 100） | 一天最多留言總數 |
| **單圖上限** | **單張圖片** | **20 條** | **每個人對每張圖最多 20 條** ⭐ |

### **針對「留言內容」的限制：**

| 限制類型 | 限制 | 說明 |
|---------|------|------|
| 最少字數 | 2 字 | 避免「+1」「讚」 |
| 最多字數 | 500 字 | 避免洗版 |
| 重複檢測 | 最近 5 條 | 不能複製貼上相同內容 |

---

## 📈 **實際場景分析**

### **場景 1：深度技術討論（正常使用）**

```
圖片：「ComfyUI 節點教學」

用戶 A（學習者）：
- 提問 5 個問題
- 回覆作者 3 次
- 感謝 2 次
總計：10 條留言 ✅ 還有 10 條配額

體驗：✅ 完全不受影響
```

---

### **場景 2：惡意刷留言（被限制）**

```
惡意用戶想刷分：

圖片 A：
- 「好」「很好」「真好」... × 20 條 → 達到單圖上限 ❌

圖片 B：
- 「讚」「推」「頂」... × 20 條 → 達到單圖上限 ❌

圖片 C：
- 「棒」「優」... × 10 條 → ❌ 每日上限（50 條）

結果：
✅ 最多獲得 100 分（50 條 × 2）
✅ 需要大量時間（至少 150 秒）
✅ 需要 50 個不同內容
✅ 第二天才能繼續

vs 點讚獲得 100 分（12.5 個讚）：
✅ 只需 13 秒

結論：刷留言完全不划算！✅
```

---

### **場景 3：超熱門圖片（不受限制）**

```
圖片：「震撼的 AI 藝術」

100 個用戶參與討論：
- 每人平均留言 5 條
- 總留言數：500 條 ✅

熱門度：
- commentsCount = 500
- 留言分數 = 500 × 2 = 1000 分
- popScore = 其他分數 + 1000

結果：
✅ 熱門圖片確實會排名很高
✅ 反映真實討論熱度
✅ 沒有被單圖上限限制
```

---

## 🔄 **如果覺得 20 條太少？**

可以調整 `utils/commentLimits.js`：

```javascript
// 改為 30 條
export const COMMENT_PER_IMAGE_LIMIT = 30;

// 或改為 50 條
export const COMMENT_PER_IMAGE_LIMIT = 50;
```

**建議：**
- 20 條：✅ 適合一般討論（推薦）
- 30 條：適合深度技術討論
- 50 條：可能太寬鬆，容易被刷

---

## ✅ **你剛才的測試結果**

**測試：** 留言 1 個字  
**預期：** ❌ 被拒絕  
**實際：** ❌ 400 錯誤  
**狀態：** ✅ 防刷機制正常工作！

**改進：** ✅ 已添加友好的錯誤提示（alert）

---

## 🧪 **現在可以測試：**

1. **留言 2 個字以上** → 應該成功
2. **立即再留言** → 應該顯示「請等待 X 秒後再留言」
3. **等待 3 秒後再留言** → 應該成功

---

## 🎉 **總結**

**單圖上限 20 條 = 每個人對每張圖最多 20 條留言**

**好處：**
- ✅ 防止單人刷留言
- ✅ 不限制總討論數
- ✅ 熱門圖可以有數百條留言
- ✅ 每個人都有公平的討論機會

**剛才的錯誤證明：防刷機制完全正常運作！** 🎊🛡️

**現在試試留言 2 個字以上，應該就成功了！** 😊
