# 管理員積分發送指南

## 📋 功能說明

管理員專用的積分發送功能，用於測試積分系統和權力券購買。

---

## 🎯 使用方式

### **方法 1: 使用管理員面板（推薦）**

1. **訪問首頁**
   - 登入管理員帳號
   - 滾動到頁面底部的「管理員面板」

2. **找到積分管理區塊**
   - 黃色邊框的「💰 積分管理（測試用）」區塊

3. **快速發送積分**
   - 點擊快速按鈕：100、500、1000、5000、10000
   - 或手動輸入自訂積分數量
   - 點擊「💰 給我積分」按鈕

4. **確認結果**
   - 成功後會顯示原積分和新積分
   - 頁面會自動刷新以更新顯示

---

### **方法 2: 使用API端點**

#### **給自己發積分**
```bash
POST /api/admin/give-me-points
Content-Type: application/json

{
  "amount": 1000
}
```

**響應：**
```json
{
  "success": true,
  "message": "成功獲得 1000 積分！",
  "data": {
    "oldBalance": 0,
    "newBalance": 1000,
    "added": 1000
  }
}
```

---

#### **給其他用戶發積分**
```bash
POST /api/admin/send-points
Content-Type: application/json

{
  "targetUserId": "用戶ID",
  "amount": 1000,
  "reason": "測試用"
}
```

**響應：**
```json
{
  "success": true,
  "message": "成功發送 1000 積分",
  "data": {
    "targetUser": {
      "id": "用戶ID",
      "username": "用戶名",
      "oldBalance": 0,
      "newBalance": 1000
    }
  }
}
```

---

## 🔒 權限要求

- ✅ 必須是管理員（`isAdmin: true`）
- ✅ 必須已登入

**非管理員調用會返回：**
```json
{
  "success": false,
  "message": "無權限"
}
```

---

## 💡 使用場景

### **1. 測試權力券購買**
```
1. 給自己發送 1000 積分
2. 前往積分商店
3. 購買 7天權力券（30積分）或 30天權力券（100積分）
4. 測試權力券使用功能
```

### **2. 測試訂閱系統**
```
1. 給自己發送 5000 積分
2. 訪問測試頁面 /test-exposure
3. 測試訂閱激活功能
4. 確認曝光分數加成效果
```

### **3. 測試限購規則**
```
1. 購買 7天券（3天限購1張）
2. 嘗試再次購買
3. 確認限購提示
```

### **4. 測試硬規則**
```
1. 購買多張權力券
2. 對同一張圖片使用多次
3. 測試冷卻時間、數量限制等規則
```

---

## 📊 積分餘額初始化

**新用戶積分餘額：**
- 默認為 `0`
- 首次發送積分時會自動初始化
- 如果積分欄位不存在，API會自動創建並設為 `0`

---

## ⚠️ 注意事項

1. **僅限測試環境使用**
   - 此功能僅用於開發和測試
   - 生產環境應該移除或嚴格限制

2. **積分不可撤回**
   - 發送的積分無法撤回
   - 請謹慎操作

3. **日誌記錄**
   - 所有積分發送都會記錄在伺服器日誌中
   - 格式：`💰 管理員 [username] 發送 [amount] 積分給 [target]`

4. **頁面刷新**
   - 發送積分後頁面會自動刷新
   - 確保數據顯示為最新狀態

---

## 🐛 故障排除

### **問題 1: 點擊按鈕無反應**
- **原因**: 未登入或非管理員
- **解決**: 確認已登入管理員帳號

### **問題 2: 提示「無權限」**
- **原因**: 當前用戶不是管理員
- **解決**: 檢查用戶的 `isAdmin` 欄位

### **問題 3: 積分未更新**
- **原因**: 頁面未刷新
- **解決**: 手動刷新頁面（F5）

### **問題 4: 積分為 undefined**
- **原因**: 用戶資料中沒有 `pointsBalance` 欄位
- **解決**: 發送任意積分會自動初始化

---

## 📝 開發日誌

- **2025-10-08**: 創建管理員積分發送功能
- **功能**: 
  - ✅ 給自己發積分 API
  - ✅ 給其他用戶發積分 API
  - ✅ 管理員面板 UI
  - ✅ 快速按鈕（100-10000）
  - ✅ 自動初始化積分餘額

---

**Happy Testing! 💰**


